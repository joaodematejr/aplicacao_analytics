{"ast":null,"code":"import _classCallCheck from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/src/@fuse/components/FuseAuthorization/FuseAuthorization.js\";\nimport React, { Component } from 'react';\nimport { matchRoutes } from 'react-router-config';\nimport { withRouter } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport AppContext from 'app/AppContext';\n\nvar FuseAuthorization =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(FuseAuthorization, _Component);\n\n  function FuseAuthorization(props, context) {\n    var _this;\n\n    _classCallCheck(this, FuseAuthorization);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(FuseAuthorization).call(this, props));\n    var routes = context.routes;\n    _this.state = {\n      accessGranted: true,\n      routes: routes\n    };\n    return _this;\n  }\n\n  _createClass(FuseAuthorization, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (!this.state.accessGranted) {\n        this.redirectRoute(this.props);\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      if (!this.state.accessGranted) {\n        this.redirectRoute(this.props);\n      }\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps, nextState) {\n      return nextState.accessGranted !== this.state.accessGranted;\n    }\n  }, {\n    key: \"redirectRoute\",\n    value: function redirectRoute(props) {\n      var location = props.location,\n          user = props.user,\n          history = props.history;\n      var pathname = location.pathname,\n          state = location.state;\n      /*\n      User is guest\n      Redirect to Login Page\n      */\n\n      if (user.role === 'guest') {\n        history.push({\n          pathname: '/login',\n          state: {\n            redirectUrl: pathname\n          }\n        });\n      }\n      /*\n      User is member\n      User must be on unAuthorized page or just logged in\n      Redirect to dashboard or redirectUrl\n      */\n      else {\n          var redirectUrl = state && state.redirectUrl ? state.redirectUrl : '/';\n          history.push({\n            pathname: redirectUrl\n          });\n        }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var children = this.props.children;\n      var accessGranted = this.state.accessGranted; // console.info('Fuse Authorization rendered', accessGranted);\n\n      return accessGranted ? React.createElement(React.Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89\n        },\n        __self: this\n      }, children) : null;\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(props, state) {\n      var location = props.location,\n          user = props.user;\n      var pathname = location.pathname;\n      var matched = matchRoutes(state.routes, pathname)[0];\n      var accessGranted = matched && matched.route.auth && matched.route.auth.length > 0 ? matched.route.auth.includes(user.role) : true;\n      return {\n        accessGranted: accessGranted\n      };\n    }\n  }]);\n\n  return FuseAuthorization;\n}(Component);\n\nfunction mapStateToProps(_ref) {\n  var fuse = _ref.fuse,\n      auth = _ref.auth;\n  return {\n    user: auth.user\n  };\n}\n\nFuseAuthorization.contextType = AppContext;\nexport default withRouter(connect(mapStateToProps)(FuseAuthorization));","map":{"version":3,"sources":["/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/src/@fuse/components/FuseAuthorization/FuseAuthorization.js"],"names":["React","Component","matchRoutes","withRouter","connect","AppContext","FuseAuthorization","props","context","routes","state","accessGranted","redirectRoute","nextProps","nextState","location","user","history","pathname","role","push","redirectUrl","children","matched","route","auth","length","includes","mapStateToProps","fuse","contextType"],"mappings":";;;;;;AAAA,OAAOA,KAAP,IAAeC,SAAf,QAA+B,OAA/B;AACA,SAAQC,WAAR,QAA0B,qBAA1B;AACA,SAAQC,UAAR,QAAyB,kBAAzB;AACA,SAAQC,OAAR,QAAsB,aAAtB;AACA,OAAOC,UAAP,MAAuB,gBAAvB;;IAEMC,iB;;;;;AAEF,6BAAYC,KAAZ,EAAmBC,OAAnB,EACA;AAAA;;AAAA;;AACI,2FAAMD,KAAN;AADJ,QAEWE,MAFX,GAEqBD,OAFrB,CAEWC,MAFX;AAGI,UAAKC,KAAL,GAAa;AACTC,MAAAA,aAAa,EAAE,IADN;AAETF,MAAAA,MAAM,EAANA;AAFS,KAAb;AAHJ;AAOC;;;;wCAGD;AACI,UAAK,CAAC,KAAKC,KAAL,CAAWC,aAAjB,EACA;AACI,aAAKC,aAAL,CAAmB,KAAKL,KAAxB;AACH;AACJ;;;yCAGD;AACI,UAAK,CAAC,KAAKG,KAAL,CAAWC,aAAjB,EACA;AACI,aAAKC,aAAL,CAAmB,KAAKL,KAAxB;AACH;AACJ;;;0CAgBqBM,S,EAAWC,S,EACjC;AACI,aAAOA,SAAS,CAACH,aAAV,KAA4B,KAAKD,KAAL,CAAWC,aAA9C;AACH;;;kCAEaJ,K,EACd;AAAA,UACWQ,QADX,GACsCR,KADtC,CACWQ,QADX;AAAA,UACqBC,IADrB,GACsCT,KADtC,CACqBS,IADrB;AAAA,UAC2BC,OAD3B,GACsCV,KADtC,CAC2BU,OAD3B;AAAA,UAEWC,QAFX,GAE8BH,QAF9B,CAEWG,QAFX;AAAA,UAEqBR,KAFrB,GAE8BK,QAF9B,CAEqBL,KAFrB;AAGI;;;;;AAIA,UAAKM,IAAI,CAACG,IAAL,KAAc,OAAnB,EACA;AACIF,QAAAA,OAAO,CAACG,IAAR,CAAa;AACTF,UAAAA,QAAQ,EAAE,QADD;AAETR,UAAAA,KAAK,EAAK;AAACW,YAAAA,WAAW,EAAEH;AAAd;AAFD,SAAb;AAIH;AACD;;;;;AAPA,WAaA;AACI,cAAMG,WAAW,GAAGX,KAAK,IAAIA,KAAK,CAACW,WAAf,GAA6BX,KAAK,CAACW,WAAnC,GAAiD,GAArE;AAEAJ,UAAAA,OAAO,CAACG,IAAR,CAAa;AACTF,YAAAA,QAAQ,EAAEG;AADD,WAAb;AAGH;AACJ;;;6BAGD;AAAA,UACWC,QADX,GACuB,KAAKf,KAD5B,CACWe,QADX;AAAA,UAEWX,aAFX,GAE4B,KAAKD,KAFjC,CAEWC,aAFX,EAGI;;AACA,aAAOA,aAAa,GAAG,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAiBW,QAAjB,CAAH,GAAiD,IAArE;AACH;;;6CAvD+Bf,K,EAAOG,K,EACvC;AAAA,UACWK,QADX,GAC6BR,KAD7B,CACWQ,QADX;AAAA,UACqBC,IADrB,GAC6BT,KAD7B,CACqBS,IADrB;AAAA,UAEWE,QAFX,GAEuBH,QAFvB,CAEWG,QAFX;AAII,UAAMK,OAAO,GAAGrB,WAAW,CAACQ,KAAK,CAACD,MAAP,EAAeS,QAAf,CAAX,CAAoC,CAApC,CAAhB;AAEA,UAAMP,aAAa,GAAIY,OAAO,IAAIA,OAAO,CAACC,KAAR,CAAcC,IAAzB,IAAiCF,OAAO,CAACC,KAAR,CAAcC,IAAd,CAAmBC,MAAnB,GAA4B,CAA9D,GAAmEH,OAAO,CAACC,KAAR,CAAcC,IAAd,CAAmBE,QAAnB,CAA4BX,IAAI,CAACG,IAAjC,CAAnE,GAA4G,IAAlI;AAEA,aAAO;AACHR,QAAAA,aAAa,EAAbA;AADG,OAAP;AAGH;;;;EAxC2BV,S;;AAsFhC,SAAS2B,eAAT,OACA;AAAA,MAD0BC,IAC1B,QAD0BA,IAC1B;AAAA,MADgCJ,IAChC,QADgCA,IAChC;AACI,SAAO;AACHT,IAAAA,IAAI,EAAES,IAAI,CAACT;AADR,GAAP;AAGH;;AAEDV,iBAAiB,CAACwB,WAAlB,GAAgCzB,UAAhC;AAEA,eAAeF,UAAU,CAACC,OAAO,CAACwB,eAAD,CAAP,CAAyBtB,iBAAzB,CAAD,CAAzB","sourcesContent":["import React, {Component} from 'react';\nimport {matchRoutes} from 'react-router-config';\nimport {withRouter} from 'react-router-dom';\nimport {connect} from 'react-redux';\nimport AppContext from 'app/AppContext';\n\nclass FuseAuthorization extends Component {\n\n    constructor(props, context)\n    {\n        super(props);\n        const {routes} = context;\n        this.state = {\n            accessGranted: true,\n            routes\n        };\n    }\n\n    componentDidMount()\n    {\n        if ( !this.state.accessGranted )\n        {\n            this.redirectRoute(this.props);\n        }\n    }\n\n    componentDidUpdate()\n    {\n        if ( !this.state.accessGranted )\n        {\n            this.redirectRoute(this.props);\n        }\n    }\n\n    static getDerivedStateFromProps(props, state)\n    {\n        const {location, user} = props;\n        const {pathname} = location;\n\n        const matched = matchRoutes(state.routes, pathname)[0];\n\n        const accessGranted = (matched && matched.route.auth && matched.route.auth.length > 0) ? matched.route.auth.includes(user.role) : true;\n\n        return {\n            accessGranted\n        };\n    }\n\n    shouldComponentUpdate(nextProps, nextState)\n    {\n        return nextState.accessGranted !== this.state.accessGranted;\n    }\n\n    redirectRoute(props)\n    {\n        const {location, user, history} = props;\n        const {pathname, state} = location;\n        /*\n        User is guest\n        Redirect to Login Page\n        */\n        if ( user.role === 'guest' )\n        {\n            history.push({\n                pathname: '/login',\n                state   : {redirectUrl: pathname}\n            });\n        }\n        /*\n        User is member\n        User must be on unAuthorized page or just logged in\n        Redirect to dashboard or redirectUrl\n        */\n        else\n        {\n            const redirectUrl = state && state.redirectUrl ? state.redirectUrl : '/';\n\n            history.push({\n                pathname: redirectUrl\n            });\n        }\n    }\n\n    render()\n    {\n        const {children} = this.props;\n        const {accessGranted} = this.state;\n        // console.info('Fuse Authorization rendered', accessGranted);\n        return accessGranted ? <React.Fragment>{children}</React.Fragment> : null;\n    }\n}\n\nfunction mapStateToProps({fuse, auth})\n{\n    return {\n        user: auth.user\n    }\n}\n\nFuseAuthorization.contextType = AppContext;\n\nexport default withRouter(connect(mapStateToProps)(FuseAuthorization));\n"]},"metadata":{},"sourceType":"module"}