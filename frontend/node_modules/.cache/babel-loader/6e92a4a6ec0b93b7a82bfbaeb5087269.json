{"ast":null,"code":"import _classCallCheck from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/src/app/fuse-layouts/shared-components/chatPanel/Chat.js\";\nimport React, { Component } from 'react';\nimport { Avatar, Paper, Typography, withStyles, TextField, IconButton, Icon } from '@material-ui/core';\nimport { FuseScrollbars } from '@fuse';\nimport classNames from 'classnames';\nimport moment from 'moment/moment';\nimport * as Actions from './store/actions';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport _ from '@lodash';\n\nvar styles = function styles(theme) {\n  return {\n    messageRow: {\n      position: 'relative',\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'flex-start',\n      justifyContent: 'flex-end',\n      padding: '0 16px 4px 16px',\n      flex: '0 0 auto',\n      '&.contact': {\n        '& $bubble': {\n          backgroundColor: theme.palette.primary.main,\n          color: theme.palette.primary.contrastText,\n          borderTopLeftRadius: 5,\n          borderBottomLeftRadius: 5,\n          borderTopRightRadius: 20,\n          borderBottomRightRadius: 20,\n          '& $time': {\n            marginLeft: 12\n          }\n        },\n        '&.first-of-group': {\n          '& $bubble': {\n            borderTopLeftRadius: 20\n          }\n        },\n        '&.last-of-group': {\n          '& $bubble': {\n            borderBottomLeftRadius: 20\n          }\n        }\n      },\n      '&.me': {\n        paddingLeft: 40,\n        '& $avatar': {\n          order: 2,\n          margin: '0 0 0 16px'\n        },\n        '& $bubble': {\n          marginLeft: 'auto',\n          backgroundColor: theme.palette.grey[300],\n          color: theme.palette.getContrastText(theme.palette.grey[300]),\n          borderTopLeftRadius: 20,\n          borderBottomLeftRadius: 20,\n          borderTopRightRadius: 5,\n          borderBottomRightRadius: 5,\n          '& $time': {\n            justifyContent: 'flex-end',\n            right: 0,\n            marginRight: 12\n          }\n        },\n        '&.first-of-group': {\n          '& $bubble': {\n            borderTopRightRadius: 20\n          }\n        },\n        '&.last-of-group': {\n          '& $bubble': {\n            borderBottomRightRadius: 20\n          }\n        }\n      },\n      '&.contact + .me, &.me + .contact': {\n        paddingTop: 20,\n        marginTop: 20\n      },\n      '&.first-of-group': {\n        '& $bubble': {\n          borderTopLeftRadius: 20,\n          paddingTop: 13\n        }\n      },\n      '&.last-of-group': {\n        '& $bubble': {\n          borderBottomLeftRadius: 20,\n          paddingBottom: 13,\n          '& $time': {\n            display: 'flex'\n          }\n        }\n      }\n    },\n    avatar: {\n      position: 'absolute',\n      left: -32,\n      margin: 0\n    },\n    bubble: {\n      position: 'relative',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      padding: 12,\n      maxWidth: '100%'\n    },\n    message: {\n      whiteSpace: 'pre-wrap',\n      lineHeight: 1.2\n    },\n    time: {\n      position: 'absolute',\n      display: 'none',\n      width: '100%',\n      fontSize: 11,\n      marginTop: 8,\n      top: '100%',\n      left: 0,\n      whiteSpace: 'nowrap'\n    },\n    bottom: {\n      background: theme.palette.background.default,\n      borderTop: '1px solid rgba(0, 0, 0, 0.13)'\n    },\n    inputWrapper: {\n      borderRadius: 24\n    }\n  };\n};\n\nvar Chat =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Chat, _Component);\n\n  function Chat() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Chat);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Chat)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      messageText: ''\n    };\n\n    _this.shouldShowContactAvatar = function (item, i) {\n      return item.who === _this.props.selectedContactId && (_this.props.chat.dialog[i + 1] && _this.props.chat.dialog[i + 1].who !== _this.props.selectedContactId || !_this.props.chat.dialog[i + 1]);\n    };\n\n    _this.isFirstMessageOfGroup = function (item, i) {\n      return i === 0 || _this.props.chat.dialog[i - 1] && _this.props.chat.dialog[i - 1].who !== item.who;\n    };\n\n    _this.isLastMessageOfGroup = function (item, i) {\n      return i === _this.props.chat.dialog.length - 1 || _this.props.chat.dialog[i + 1] && _this.props.chat.dialog[i + 1].who !== item.who;\n    };\n\n    _this.onInputChange = function (ev) {\n      _this.setState({\n        messageText: ev.target.value\n      });\n    };\n\n    _this.scrollToBottom = function () {\n      _this.chatScroll.scrollTop = _this.chatScroll.scrollHeight;\n    };\n\n    return _this;\n  }\n\n  _createClass(Chat, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (this.props.chat && !_.isEqual(prevProps.chat, this.props.chat)) {\n        this.scrollToBottom();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          classes = _this$props.classes,\n          chat = _this$props.chat,\n          contacts = _this$props.contacts,\n          user = _this$props.user,\n          className = _this$props.className;\n      var messageText = this.state.messageText;\n      return React.createElement(Paper, {\n        elevation: 3,\n        className: classNames(\"flex flex-col\", className),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, React.createElement(FuseScrollbars, {\n        containerRef: function containerRef(ref) {\n          _this2.chatScroll = ref;\n        },\n        className: \"flex flex-1 flex-col overflow-y-auto\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175\n        },\n        __self: this\n      }, !chat ? React.createElement(\"div\", {\n        className: \"flex flex-col flex-1 items-center justify-center p-24\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        className: \"text-128\",\n        color: \"disabled\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }, \"chat\"), React.createElement(Typography, {\n        className: \"px-16 pb-24 mt-24 text-center\",\n        color: \"textSecondary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }, \"Select a contact to start a conversation.\")) : chat.dialog.length > 0 ? React.createElement(\"div\", {\n        className: \"flex flex-col pt-16 pl-40 pb-40\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, chat.dialog.map(function (item, i) {\n        var contact = item.who === user.id ? user : contacts.find(function (_contact) {\n          return _contact.id === item.who;\n        });\n        return React.createElement(\"div\", {\n          key: item.time,\n          className: classNames(classes.messageRow, {\n            'me': item.who === user.id\n          }, {\n            'contact': item.who !== user.id\n          }, {\n            'first-of-group': _this2.isFirstMessageOfGroup(item, i)\n          }, {\n            'last-of-group': _this2.isLastMessageOfGroup(item, i)\n          }),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 196\n          },\n          __self: this\n        }, _this2.shouldShowContactAvatar(item, i) && React.createElement(Avatar, {\n          className: classes.avatar,\n          src: contact.avatar,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 207\n          },\n          __self: this\n        }), React.createElement(\"div\", {\n          className: classes.bubble,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 209\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: classes.message,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 210\n          },\n          __self: this\n        }, item.message), React.createElement(Typography, {\n          className: classes.time,\n          color: \"textSecondary\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 211\n          },\n          __self: this\n        }, moment(item.time).format('MMMM Do YYYY, h:mm:ss a'))));\n      })) : React.createElement(\"div\", {\n        className: \"flex flex-col flex-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"flex flex-col flex-1 items-center justify-center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        className: \"text-128\",\n        color: \"disabled\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220\n        },\n        __self: this\n      }, \"chat\")), React.createElement(Typography, {\n        className: \"px-16 pb-24 text-center\",\n        color: \"textSecondary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }, \"Start a conversation by typing your message below.\"))), chat && React.createElement(\"form\", {\n        onSubmit: this.onMessageSubmit,\n        className: classNames(classes.bottom, \"py-16 px-8\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }, React.createElement(Paper, {\n        className: classNames(classes.inputWrapper, \"flex items-center relative\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        autoFocus: false,\n        id: \"message-input\",\n        className: \"flex-1\",\n        InputProps: {\n          disableUnderline: true,\n          classes: {\n            root: \"flex flex-grow flex-no-shrink ml-16 mr-48 my-8\",\n            input: \"\"\n          },\n          placeholder: \"Type your message\"\n        },\n        InputLabelProps: {\n          shrink: false,\n          className: classes.bootstrapFormLabel\n        },\n        onChange: this.onInputChange,\n        value: messageText,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }), React.createElement(IconButton, {\n        className: \"absolute pin-r pin-t\",\n        type: \"submit\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        className: \"text-24\",\n        color: \"action\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, \"send\")))));\n    }\n  }]);\n\n  return Chat;\n}(Component);\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators({\n    sendMessage: Actions.sendMessage\n  }, dispatch);\n}\n\nfunction mapStateToProps(_ref) {\n  var chatPanel = _ref.chatPanel;\n  return {\n    contacts: chatPanel.contacts.entities,\n    selectedContactId: chatPanel.contacts.selectedContactId,\n    chat: chatPanel.chat,\n    user: chatPanel.user\n  };\n}\n\nexport default withStyles(styles)(connect(mapStateToProps, mapDispatchToProps)(Chat));","map":{"version":3,"sources":["/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/src/app/fuse-layouts/shared-components/chatPanel/Chat.js"],"names":["React","Component","Avatar","Paper","Typography","withStyles","TextField","IconButton","Icon","FuseScrollbars","classNames","moment","Actions","bindActionCreators","connect","_","styles","theme","messageRow","position","display","flexDirection","alignItems","justifyContent","padding","flex","backgroundColor","palette","primary","main","color","contrastText","borderTopLeftRadius","borderBottomLeftRadius","borderTopRightRadius","borderBottomRightRadius","marginLeft","paddingLeft","order","margin","grey","getContrastText","right","marginRight","paddingTop","marginTop","paddingBottom","avatar","left","bubble","maxWidth","message","whiteSpace","lineHeight","time","width","fontSize","top","bottom","background","default","borderTop","inputWrapper","borderRadius","Chat","state","messageText","shouldShowContactAvatar","item","i","who","props","selectedContactId","chat","dialog","isFirstMessageOfGroup","isLastMessageOfGroup","length","onInputChange","ev","setState","target","value","scrollToBottom","chatScroll","scrollTop","scrollHeight","prevProps","isEqual","classes","contacts","user","className","ref","map","contact","id","find","_contact","format","onMessageSubmit","disableUnderline","root","input","placeholder","shrink","bootstrapFormLabel","mapDispatchToProps","dispatch","sendMessage","mapStateToProps","chatPanel","entities"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { Avatar, Paper, Typography, withStyles, TextField, IconButton, Icon } from '@material-ui/core';\nimport { FuseScrollbars } from '@fuse';\nimport classNames from 'classnames';\nimport moment from 'moment/moment';\nimport * as Actions from './store/actions';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport _ from '@lodash';\n\nconst styles = theme => ({\n    messageRow: {\n        position: 'relative',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'flex-start',\n        justifyContent: 'flex-end',\n        padding: '0 16px 4px 16px',\n        flex: '0 0 auto',\n        '&.contact': {\n            '& $bubble': {\n                backgroundColor: theme.palette.primary.main,\n                color: theme.palette.primary.contrastText,\n                borderTopLeftRadius: 5,\n                borderBottomLeftRadius: 5,\n                borderTopRightRadius: 20,\n                borderBottomRightRadius: 20,\n                '& $time': {\n                    marginLeft: 12\n                }\n            },\n            '&.first-of-group': {\n                '& $bubble': {\n                    borderTopLeftRadius: 20\n                }\n            },\n            '&.last-of-group': {\n                '& $bubble': {\n                    borderBottomLeftRadius: 20\n                }\n            }\n        },\n        '&.me': {\n            paddingLeft: 40,\n\n            '& $avatar': {\n                order: 2,\n                margin: '0 0 0 16px'\n            },\n\n            '& $bubble': {\n                marginLeft: 'auto',\n                backgroundColor: theme.palette.grey[300],\n                color: theme.palette.getContrastText(theme.palette.grey[300]),\n                borderTopLeftRadius: 20,\n                borderBottomLeftRadius: 20,\n                borderTopRightRadius: 5,\n                borderBottomRightRadius: 5,\n                '& $time': {\n                    justifyContent: 'flex-end',\n                    right: 0,\n                    marginRight: 12\n                }\n            },\n            '&.first-of-group': {\n                '& $bubble': {\n                    borderTopRightRadius: 20\n                }\n            },\n\n            '&.last-of-group': {\n                '& $bubble': {\n                    borderBottomRightRadius: 20\n                }\n            }\n        },\n        '&.contact + .me, &.me + .contact': {\n            paddingTop: 20,\n            marginTop: 20\n        },\n        '&.first-of-group': {\n            '& $bubble': {\n                borderTopLeftRadius: 20,\n                paddingTop: 13\n            }\n        },\n        '&.last-of-group': {\n            '& $bubble': {\n                borderBottomLeftRadius: 20,\n                paddingBottom: 13,\n                '& $time': {\n                    display: 'flex'\n                }\n            }\n        }\n    },\n    avatar: {\n        position: 'absolute',\n        left: -32,\n        margin: 0\n    },\n    bubble: {\n        position: 'relative',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        padding: 12,\n        maxWidth: '100%'\n    },\n    message: {\n        whiteSpace: 'pre-wrap',\n        lineHeight: 1.2\n    },\n    time: {\n        position: 'absolute',\n        display: 'none',\n        width: '100%',\n        fontSize: 11,\n        marginTop: 8,\n        top: '100%',\n        left: 0,\n        whiteSpace: 'nowrap'\n    },\n    bottom: {\n        background: theme.palette.background.default,\n        borderTop: '1px solid rgba(0, 0, 0, 0.13)'\n    },\n    inputWrapper: {\n        borderRadius: 24\n    }\n});\n\nclass Chat extends Component {\n\n    state = {\n        messageText: ''\n    };\n\n    componentDidUpdate(prevProps) {\n        if (this.props.chat && !_.isEqual(prevProps.chat, this.props.chat)) {\n            this.scrollToBottom();\n        }\n    }\n\n    shouldShowContactAvatar = (item, i) => {\n        return (\n            item.who === this.props.selectedContactId &&\n            ((this.props.chat.dialog[i + 1] && this.props.chat.dialog[i + 1].who !== this.props.selectedContactId) || !this.props.chat.dialog[i + 1])\n        );\n    };\n\n    isFirstMessageOfGroup = (item, i) => {\n        return (i === 0 || (this.props.chat.dialog[i - 1] && this.props.chat.dialog[i - 1].who !== item.who));\n    };\n\n    isLastMessageOfGroup = (item, i) => {\n        return (i === this.props.chat.dialog.length - 1 || (this.props.chat.dialog[i + 1] && this.props.chat.dialog[i + 1].who !== item.who));\n    };\n\n    onInputChange = (ev) => {\n        this.setState({ messageText: ev.target.value });\n    };\n\n\n\n    scrollToBottom = () => {\n        this.chatScroll.scrollTop = this.chatScroll.scrollHeight;\n    };\n\n    render() {\n        const { classes, chat, contacts, user, className } = this.props;\n        const { messageText } = this.state;\n        return (\n            <Paper elevation={3} className={classNames(\"flex flex-col\", className)}>\n                <FuseScrollbars\n                    containerRef={(ref) => {\n                        this.chatScroll = ref\n                    }}\n                    className=\"flex flex-1 flex-col overflow-y-auto\"\n                >\n                    {!chat ?\n                        (\n                            <div className=\"flex flex-col flex-1 items-center justify-center p-24\">\n                                <Icon className=\"text-128\" color=\"disabled\">chat</Icon>\n                                <Typography className=\"px-16 pb-24 mt-24 text-center\" color=\"textSecondary\">\n                                    Select a contact to start a conversation.\n                                </Typography>\n                            </div>\n                        ) :\n                        chat.dialog.length > 0 ?\n                            (\n                                <div className=\"flex flex-col pt-16 pl-40 pb-40\">\n                                    {chat.dialog.map((item, i) => {\n                                        const contact = item.who === user.id ? user : contacts.find(_contact => _contact.id === item.who);\n                                        return (\n                                            <div\n                                                key={item.time}\n                                                className={classNames(\n                                                    classes.messageRow,\n                                                    { 'me': item.who === user.id },\n                                                    { 'contact': item.who !== user.id },\n                                                    { 'first-of-group': this.isFirstMessageOfGroup(item, i) },\n                                                    { 'last-of-group': this.isLastMessageOfGroup(item, i) }\n                                                )}\n                                            >\n                                                {this.shouldShowContactAvatar(item, i) && (\n                                                    <Avatar className={classes.avatar} src={contact.avatar} />\n                                                )}\n                                                <div className={classes.bubble}>\n                                                    <div className={classes.message}>{item.message}</div>\n                                                    <Typography className={classes.time} color=\"textSecondary\">{moment(item.time).format('MMMM Do YYYY, h:mm:ss a')}</Typography>\n                                                </div>\n                                            </div>\n                                        )\n                                    })}\n                                </div>\n                            ) : (\n                                <div className=\"flex flex-col flex-1\">\n                                    <div className=\"flex flex-col flex-1 items-center justify-center\">\n                                        <Icon className=\"text-128\" color=\"disabled\">chat</Icon>\n                                    </div>\n                                    <Typography className=\"px-16 pb-24 text-center\" color=\"textSecondary\">\n                                        Start a conversation by typing your message below.\n                                    </Typography>\n                                </div>\n                            )\n                    }\n\n                </FuseScrollbars>\n                {chat && (\n                    <form onSubmit={this.onMessageSubmit} className={classNames(classes.bottom, \"py-16 px-8\")}>\n                        <Paper className={classNames(classes.inputWrapper, \"flex items-center relative\")}>\n                            <TextField\n                                autoFocus={false}\n                                id=\"message-input\"\n                                className=\"flex-1\"\n                                InputProps={{\n                                    disableUnderline: true,\n                                    classes: {\n                                        root: \"flex flex-grow flex-no-shrink ml-16 mr-48 my-8\",\n                                        input: \"\"\n                                    },\n                                    placeholder: \"Type your message\"\n                                }}\n                                InputLabelProps={{\n                                    shrink: false,\n                                    className: classes.bootstrapFormLabel\n                                }}\n                                onChange={this.onInputChange}\n                                value={messageText}\n                            />\n                            <IconButton className=\"absolute pin-r pin-t\" type=\"submit\">\n                                <Icon className=\"text-24\" color=\"action\">send</Icon>\n                            </IconButton>\n                        </Paper>\n                    </form>\n                )}\n            </Paper>\n        );\n    }\n}\n\nfunction mapDispatchToProps(dispatch) {\n    return bindActionCreators({\n        sendMessage: Actions.sendMessage\n    }, dispatch);\n}\n\nfunction mapStateToProps({ chatPanel }) {\n    return {\n        contacts: chatPanel.contacts.entities,\n        selectedContactId: chatPanel.contacts.selectedContactId,\n        chat: chatPanel.chat,\n        user: chatPanel.user\n    }\n}\n\nexport default withStyles(styles)(connect(mapStateToProps, mapDispatchToProps)(Chat));\n"]},"metadata":{},"sourceType":"module"}