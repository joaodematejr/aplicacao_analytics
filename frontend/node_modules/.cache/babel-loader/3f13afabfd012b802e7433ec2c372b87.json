{"ast":null,"code":"import _classCallCheck from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/src/app/fuse-layouts/shared-components/chatPanel/Chat.js\";\nimport React, { Component } from 'react';\nimport { Avatar, Paper, Typography, withStyles, TextField, IconButton, Icon } from '@material-ui/core';\nimport { FuseScrollbars } from '@fuse';\nimport classNames from 'classnames';\nimport moment from 'moment/moment';\nimport * as Actions from './store/actions';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport _ from '@lodash';\n\nvar styles = function styles(theme) {\n  return {\n    messageRow: {\n      position: 'relative',\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'flex-start',\n      justifyContent: 'flex-end',\n      padding: '0 16px 4px 16px',\n      flex: '0 0 auto',\n      '&.contact': {\n        '& $bubble': {\n          backgroundColor: theme.palette.primary.main,\n          color: theme.palette.primary.contrastText,\n          borderTopLeftRadius: 5,\n          borderBottomLeftRadius: 5,\n          borderTopRightRadius: 20,\n          borderBottomRightRadius: 20,\n          '& $time': {\n            marginLeft: 12\n          }\n        },\n        '&.first-of-group': {\n          '& $bubble': {\n            borderTopLeftRadius: 20\n          }\n        },\n        '&.last-of-group': {\n          '& $bubble': {\n            borderBottomLeftRadius: 20\n          }\n        }\n      },\n      '&.me': {\n        paddingLeft: 40,\n        '& $avatar': {\n          order: 2,\n          margin: '0 0 0 16px'\n        },\n        '& $bubble': {\n          marginLeft: 'auto',\n          backgroundColor: theme.palette.grey[300],\n          color: theme.palette.getContrastText(theme.palette.grey[300]),\n          borderTopLeftRadius: 20,\n          borderBottomLeftRadius: 20,\n          borderTopRightRadius: 5,\n          borderBottomRightRadius: 5,\n          '& $time': {\n            justifyContent: 'flex-end',\n            right: 0,\n            marginRight: 12\n          }\n        },\n        '&.first-of-group': {\n          '& $bubble': {\n            borderTopRightRadius: 20\n          }\n        },\n        '&.last-of-group': {\n          '& $bubble': {\n            borderBottomRightRadius: 20\n          }\n        }\n      },\n      '&.contact + .me, &.me + .contact': {\n        paddingTop: 20,\n        marginTop: 20\n      },\n      '&.first-of-group': {\n        '& $bubble': {\n          borderTopLeftRadius: 20,\n          paddingTop: 13\n        }\n      },\n      '&.last-of-group': {\n        '& $bubble': {\n          borderBottomLeftRadius: 20,\n          paddingBottom: 13,\n          '& $time': {\n            display: 'flex'\n          }\n        }\n      }\n    },\n    avatar: {\n      position: 'absolute',\n      left: -32,\n      margin: 0\n    },\n    bubble: {\n      position: 'relative',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      padding: 12,\n      maxWidth: '100%'\n    },\n    message: {\n      whiteSpace: 'pre-wrap',\n      lineHeight: 1.2\n    },\n    time: {\n      position: 'absolute',\n      display: 'none',\n      width: '100%',\n      fontSize: 11,\n      marginTop: 8,\n      top: '100%',\n      left: 0,\n      whiteSpace: 'nowrap'\n    },\n    bottom: {\n      background: theme.palette.background.default,\n      borderTop: '1px solid rgba(0, 0, 0, 0.13)'\n    },\n    inputWrapper: {\n      borderRadius: 24\n    }\n  };\n};\n\nvar Chat =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Chat, _Component);\n\n  function Chat() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Chat);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Chat)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      messageText: ''\n    };\n\n    _this.shouldShowContactAvatar = function (item, i) {\n      return item.who === _this.props.selectedContactId && (_this.props.chat.dialog[i + 1] && _this.props.chat.dialog[i + 1].who !== _this.props.selectedContactId || !_this.props.chat.dialog[i + 1]);\n    };\n\n    _this.isFirstMessageOfGroup = function (item, i) {\n      return i === 0 || _this.props.chat.dialog[i - 1] && _this.props.chat.dialog[i - 1].who !== item.who;\n    };\n\n    _this.isLastMessageOfGroup = function (item, i) {\n      return i === _this.props.chat.dialog.length - 1 || _this.props.chat.dialog[i + 1] && _this.props.chat.dialog[i + 1].who !== item.who;\n    };\n\n    _this.onInputChange = function (ev) {\n      _this.setState({\n        messageText: ev.target.value\n      });\n    };\n\n    _this.onMessageSubmit = function (ev) {\n      ev.preventDefault();\n\n      if (_this.state.messageText === '') {\n        return;\n      }\n\n      _this.props.sendMessage(_this.state.messageText, _this.props.chat.id, _this.props.user.id).then(function () {\n        _this.setState({\n          messageText: ''\n        });\n\n        _this.scrollToBottom();\n      });\n    };\n\n    _this.scrollToBottom = function () {\n      _this.chatScroll.scrollTop = _this.chatScroll.scrollHeight;\n    };\n\n    return _this;\n  }\n\n  _createClass(Chat, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (this.props.chat && !_.isEqual(prevProps.chat, this.props.chat)) {\n        this.scrollToBottom();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          classes = _this$props.classes,\n          chat = _this$props.chat,\n          contacts = _this$props.contacts,\n          user = _this$props.user,\n          className = _this$props.className;\n      var messageText = this.state.messageText;\n      return React.createElement(Paper, {\n        elevation: 3,\n        className: classNames(\"flex flex-col\", className),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, React.createElement(FuseScrollbars, {\n        containerRef: function containerRef(ref) {\n          _this2.chatScroll = ref;\n        },\n        className: \"flex flex-1 flex-col overflow-y-auto\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }, !chat ? React.createElement(\"div\", {\n        className: \"flex flex-col flex-1 items-center justify-center p-24\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        className: \"text-128\",\n        color: \"disabled\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, \"chat\"), React.createElement(Typography, {\n        className: \"px-16 pb-24 mt-24 text-center\",\n        color: \"textSecondary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }, \"Select a contact to start a conversation.\")) : chat.dialog.length > 0 ? React.createElement(\"div\", {\n        className: \"flex flex-col pt-16 pl-40 pb-40\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, chat.dialog.map(function (item, i) {\n        var contact = item.who === user.id ? user : contacts.find(function (_contact) {\n          return _contact.id === item.who;\n        });\n        return React.createElement(\"div\", {\n          key: item.time,\n          className: classNames(classes.messageRow, {\n            'me': item.who === user.id\n          }, {\n            'contact': item.who !== user.id\n          }, {\n            'first-of-group': _this2.isFirstMessageOfGroup(item, i)\n          }, {\n            'last-of-group': _this2.isLastMessageOfGroup(item, i)\n          }),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 210\n          },\n          __self: this\n        }, _this2.shouldShowContactAvatar(item, i) && React.createElement(Avatar, {\n          className: classes.avatar,\n          src: contact.avatar,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 221\n          },\n          __self: this\n        }), React.createElement(\"div\", {\n          className: classes.bubble,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 223\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: classes.message,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 224\n          },\n          __self: this\n        }, item.message), React.createElement(Typography, {\n          className: classes.time,\n          color: \"textSecondary\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 225\n          },\n          __self: this\n        }, moment(item.time).format('MMMM Do YYYY, h:mm:ss a'))));\n      })) : React.createElement(\"div\", {\n        className: \"flex flex-col flex-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"flex flex-col flex-1 items-center justify-center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        className: \"text-128\",\n        color: \"disabled\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }, \"chat\")), React.createElement(Typography, {\n        className: \"px-16 pb-24 text-center\",\n        color: \"textSecondary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236\n        },\n        __self: this\n      }, \"Start a conversation by typing your message below.\"))), chat && React.createElement(\"form\", {\n        onSubmit: this.onMessageSubmit,\n        className: classNames(classes.bottom, \"py-16 px-8\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245\n        },\n        __self: this\n      }, React.createElement(Paper, {\n        className: classNames(classes.inputWrapper, \"flex items-center relative\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        autoFocus: false,\n        id: \"message-input\",\n        className: \"flex-1\",\n        InputProps: {\n          disableUnderline: true,\n          classes: {\n            root: \"flex flex-grow flex-no-shrink ml-16 mr-48 my-8\",\n            input: \"\"\n          },\n          placeholder: \"Type your message\"\n        },\n        InputLabelProps: {\n          shrink: false,\n          className: classes.bootstrapFormLabel\n        },\n        onChange: this.onInputChange,\n        value: messageText,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      }), React.createElement(IconButton, {\n        className: \"absolute pin-r pin-t\",\n        type: \"submit\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        className: \"text-24\",\n        color: \"action\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267\n        },\n        __self: this\n      }, \"send\")))));\n    }\n  }]);\n\n  return Chat;\n}(Component);\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators({\n    sendMessage: Actions.sendMessage\n  }, dispatch);\n}\n\nfunction mapStateToProps(_ref) {\n  var chatPanel = _ref.chatPanel;\n  return {\n    contacts: chatPanel.contacts.entities,\n    selectedContactId: chatPanel.contacts.selectedContactId,\n    chat: chatPanel.chat,\n    user: chatPanel.user\n  };\n}\n\nexport default withStyles(styles)(connect(mapStateToProps, mapDispatchToProps)(Chat));","map":{"version":3,"sources":["/Volumes/Documentos/facu/projetos/aplicacao_analytics/test/src/app/fuse-layouts/shared-components/chatPanel/Chat.js"],"names":["React","Component","Avatar","Paper","Typography","withStyles","TextField","IconButton","Icon","FuseScrollbars","classNames","moment","Actions","bindActionCreators","connect","_","styles","theme","messageRow","position","display","flexDirection","alignItems","justifyContent","padding","flex","backgroundColor","palette","primary","main","color","contrastText","borderTopLeftRadius","borderBottomLeftRadius","borderTopRightRadius","borderBottomRightRadius","marginLeft","paddingLeft","order","margin","grey","getContrastText","right","marginRight","paddingTop","marginTop","paddingBottom","avatar","left","bubble","maxWidth","message","whiteSpace","lineHeight","time","width","fontSize","top","bottom","background","default","borderTop","inputWrapper","borderRadius","Chat","state","messageText","shouldShowContactAvatar","item","i","who","props","selectedContactId","chat","dialog","isFirstMessageOfGroup","isLastMessageOfGroup","length","onInputChange","ev","setState","target","value","onMessageSubmit","preventDefault","sendMessage","id","user","then","scrollToBottom","chatScroll","scrollTop","scrollHeight","prevProps","isEqual","classes","contacts","className","ref","map","contact","find","_contact","format","disableUnderline","root","input","placeholder","shrink","bootstrapFormLabel","mapDispatchToProps","dispatch","mapStateToProps","chatPanel","entities"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport {Avatar, Paper, Typography, withStyles, TextField, IconButton, Icon} from '@material-ui/core';\nimport {FuseScrollbars} from '@fuse';\nimport classNames from 'classnames';\nimport moment from 'moment/moment';\nimport * as Actions from './store/actions';\nimport {bindActionCreators} from 'redux';\nimport {connect} from 'react-redux';\nimport _ from '@lodash';\n\nconst styles = theme => ({\n    messageRow  : {\n        position                          : 'relative',\n        display                           : 'flex',\n        flexDirection                     : 'column',\n        alignItems                        : 'flex-start',\n        justifyContent                    : 'flex-end',\n        padding                           : '0 16px 4px 16px',\n        flex                              : '0 0 auto',\n        '&.contact'                       : {\n            '& $bubble'       : {\n                backgroundColor        : theme.palette.primary.main,\n                color                  : theme.palette.primary.contrastText,\n                borderTopLeftRadius    : 5,\n                borderBottomLeftRadius : 5,\n                borderTopRightRadius   : 20,\n                borderBottomRightRadius: 20,\n                '& $time'              : {\n                    marginLeft: 12\n                }\n            },\n            '&.first-of-group': {\n                '& $bubble': {\n                    borderTopLeftRadius: 20\n                }\n            },\n            '&.last-of-group' : {\n                '& $bubble': {\n                    borderBottomLeftRadius: 20\n                }\n            }\n        },\n        '&.me'                            : {\n            paddingLeft: 40,\n\n            '& $avatar': {\n                order : 2,\n                margin: '0 0 0 16px'\n            },\n\n            '& $bubble'       : {\n                marginLeft             : 'auto',\n                backgroundColor        : theme.palette.grey[300],\n                color                  : theme.palette.getContrastText(theme.palette.grey[300]),\n                borderTopLeftRadius    : 20,\n                borderBottomLeftRadius : 20,\n                borderTopRightRadius   : 5,\n                borderBottomRightRadius: 5,\n                '& $time'              : {\n                    justifyContent: 'flex-end',\n                    right         : 0,\n                    marginRight   : 12\n                }\n            },\n            '&.first-of-group': {\n                '& $bubble': {\n                    borderTopRightRadius: 20\n                }\n            },\n\n            '&.last-of-group': {\n                '& $bubble': {\n                    borderBottomRightRadius: 20\n                }\n            }\n        },\n        '&.contact + .me, &.me + .contact': {\n            paddingTop: 20,\n            marginTop : 20\n        },\n        '&.first-of-group'                : {\n            '& $bubble': {\n                borderTopLeftRadius: 20,\n                paddingTop         : 13\n            }\n        },\n        '&.last-of-group'                 : {\n            '& $bubble': {\n                borderBottomLeftRadius: 20,\n                paddingBottom         : 13,\n                '& $time'             : {\n                    display: 'flex'\n                }\n            }\n        }\n    },\n    avatar      : {\n        position: 'absolute',\n        left    : -32,\n        margin  : 0\n    },\n    bubble      : {\n        position      : 'relative',\n        display       : 'flex',\n        alignItems    : 'center',\n        justifyContent: 'center',\n        padding       : 12,\n        maxWidth      : '100%'\n    },\n    message     : {\n        whiteSpace: 'pre-wrap',\n        lineHeight: 1.2\n    },\n    time        : {\n        position  : 'absolute',\n        display   : 'none',\n        width     : '100%',\n        fontSize  : 11,\n        marginTop : 8,\n        top       : '100%',\n        left      : 0,\n        whiteSpace: 'nowrap'\n    },\n    bottom      : {\n        background: theme.palette.background.default,\n        borderTop : '1px solid rgba(0, 0, 0, 0.13)'\n    },\n    inputWrapper: {\n        borderRadius: 24\n    }\n});\n\nclass Chat extends Component {\n\n    state = {\n        messageText: ''\n    };\n\n    componentDidUpdate(prevProps)\n    {\n        if ( this.props.chat && !_.isEqual(prevProps.chat, this.props.chat) )\n        {\n            this.scrollToBottom();\n        }\n    }\n\n    shouldShowContactAvatar = (item, i) => {\n        return (\n            item.who === this.props.selectedContactId &&\n            ((this.props.chat.dialog[i + 1] && this.props.chat.dialog[i + 1].who !== this.props.selectedContactId) || !this.props.chat.dialog[i + 1])\n        );\n    };\n\n    isFirstMessageOfGroup = (item, i) => {\n        return (i === 0 || (this.props.chat.dialog[i - 1] && this.props.chat.dialog[i - 1].who !== item.who));\n    };\n\n    isLastMessageOfGroup = (item, i) => {\n        return (i === this.props.chat.dialog.length - 1 || (this.props.chat.dialog[i + 1] && this.props.chat.dialog[i + 1].who !== item.who));\n    };\n\n    onInputChange = (ev) => {\n        this.setState({messageText: ev.target.value});\n    };\n\n    onMessageSubmit = (ev) => {\n        ev.preventDefault();\n        if ( this.state.messageText === '' )\n        {\n            return;\n        }\n        this.props.sendMessage(this.state.messageText, this.props.chat.id, this.props.user.id)\n            .then(() => {\n                this.setState({messageText: ''});\n                this.scrollToBottom();\n            });\n    };\n\n    scrollToBottom = () => {\n        this.chatScroll.scrollTop = this.chatScroll.scrollHeight;\n    };\n\n    render()\n    {\n        const {classes, chat, contacts, user, className} = this.props;\n        const {messageText} = this.state;\n        return (\n            <Paper elevation={3} className={classNames(\"flex flex-col\", className)}>\n                <FuseScrollbars\n                    containerRef={(ref) => {\n                        this.chatScroll = ref\n                    }}\n                    className=\"flex flex-1 flex-col overflow-y-auto\"\n                >\n                    {!chat ?\n                        (\n                            <div className=\"flex flex-col flex-1 items-center justify-center p-24\">\n                                <Icon className=\"text-128\" color=\"disabled\">chat</Icon>\n                                <Typography className=\"px-16 pb-24 mt-24 text-center\" color=\"textSecondary\">\n                                    Select a contact to start a conversation.\n                                </Typography>\n                            </div>\n                        ) :\n                        chat.dialog.length > 0 ?\n                            (\n                                <div className=\"flex flex-col pt-16 pl-40 pb-40\">\n                                    {chat.dialog.map((item, i) => {\n                                        const contact = item.who === user.id ? user : contacts.find(_contact => _contact.id === item.who);\n                                        return (\n                                            <div\n                                                key={item.time}\n                                                className={classNames(\n                                                    classes.messageRow,\n                                                    {'me': item.who === user.id},\n                                                    {'contact': item.who !== user.id},\n                                                    {'first-of-group': this.isFirstMessageOfGroup(item, i)},\n                                                    {'last-of-group': this.isLastMessageOfGroup(item, i)}\n                                                )}\n                                            >\n                                                {this.shouldShowContactAvatar(item, i) && (\n                                                    <Avatar className={classes.avatar} src={contact.avatar}/>\n                                                )}\n                                                <div className={classes.bubble}>\n                                                    <div className={classes.message}>{item.message}</div>\n                                                    <Typography className={classes.time} color=\"textSecondary\">{moment(item.time).format('MMMM Do YYYY, h:mm:ss a')}</Typography>\n                                                </div>\n                                            </div>\n                                        )\n                                    })}\n                                </div>\n                            ) : (\n                                <div className=\"flex flex-col flex-1\">\n                                    <div className=\"flex flex-col flex-1 items-center justify-center\">\n                                        <Icon className=\"text-128\" color=\"disabled\">chat</Icon>\n                                    </div>\n                                    <Typography className=\"px-16 pb-24 text-center\" color=\"textSecondary\">\n                                        Start a conversation by typing your message below.\n                                    </Typography>\n                                </div>\n                            )\n                    }\n\n                </FuseScrollbars>\n                {chat && (\n                    <form onSubmit={this.onMessageSubmit} className={classNames(classes.bottom, \"py-16 px-8\")}>\n                        <Paper className={classNames(classes.inputWrapper, \"flex items-center relative\")}>\n                            <TextField\n                                autoFocus={false}\n                                id=\"message-input\"\n                                className=\"flex-1\"\n                                InputProps={{\n                                    disableUnderline: true,\n                                    classes         : {\n                                        root : \"flex flex-grow flex-no-shrink ml-16 mr-48 my-8\",\n                                        input: \"\"\n                                    },\n                                    placeholder     : \"Type your message\"\n                                }}\n                                InputLabelProps={{\n                                    shrink   : false,\n                                    className: classes.bootstrapFormLabel\n                                }}\n                                onChange={this.onInputChange}\n                                value={messageText}\n                            />\n                            <IconButton className=\"absolute pin-r pin-t\" type=\"submit\">\n                                <Icon className=\"text-24\" color=\"action\">send</Icon>\n                            </IconButton>\n                        </Paper>\n                    </form>\n                )}\n            </Paper>\n        );\n    }\n}\n\nfunction mapDispatchToProps(dispatch)\n{\n    return bindActionCreators({\n        sendMessage: Actions.sendMessage\n    }, dispatch);\n}\n\nfunction mapStateToProps({chatPanel})\n{\n    return {\n        contacts         : chatPanel.contacts.entities,\n        selectedContactId: chatPanel.contacts.selectedContactId,\n        chat             : chatPanel.chat,\n        user             : chatPanel.user\n    }\n}\n\nexport default withStyles(styles)(connect(mapStateToProps, mapDispatchToProps)(Chat));\n"]},"metadata":{},"sourceType":"module"}